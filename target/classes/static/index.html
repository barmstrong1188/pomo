<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pomodoro Timer Settings</title>
<link rel="stylesheet" href="./css/styles.css">
</head>
<body>
<img src="./logos/blacklogo.png" alt="logo">

<button id="settingsButton">Settings</button>

<!-- Modal for settings -->
<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <label for="workDuration">Work Duration (minutes):</label>
        <input type="number" id="workDuration" name="workDuration" value="25">

        <label for="breakDuration">Break Duration (minutes):</label>
        <input type="number" id="breakDuration" name="breakDuration" value="5">

        <button id="saveSettings">Save Settings</button>
    </div>
</div>

<!-- Modal Alert -->
<div id="endSessionModal" style="display:none; position:fixed; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background-color:white; margin:15% auto; padding:20px; border-radius:5px; width:30%;">
        <h2 id="modalTitle">Session Ended</h2>
        <p id="modalBody">Your work session has ended. Time for a break!</p>
        <button onclick="closeModalAndContinue()">OK</button>
    </div>
</div>


<div id="timerPreset"></div>
<div id="timerClock"></div>

<!-- <button onclick="testNotification()">Test Notification</button> -->
<audio id="workEndSound" src="./sounds/celebration.wav" preload="auto"></audio>
<audio id="breakEndSound" src="./sounds/bubbles.wav" preload="auto"></audio>
<!-- <button onclick="playSoundTest()">Test Sound</button>

<script>
function playSoundTest() {
    var sound = document.getElementById('workEndSound');
    sound.play().catch(error => console.error('Error playing sound:', error));
}


    function notifyUser(message, nextAction) {
    console.log("Attempting to send a notification:", message);
    document.getElementById('modalTitle').textContent = nextAction === 'work' ? 'Break Over' : 'Work Over';
    document.getElementById('modalBody').textContent = message;
    document.getElementById('endSessionModal').style.display = 'block';

    // Determine which sound to play based on the session type
    var soundId = nextAction === 'work' ? 'breakEndSound' : 'workEndSound';
    // var sound = document.getElementById(soundId);
    var sound = document.getElementById('breakEndSound');
    sound.play().catch(error => console.error('Error playing sound:', error));
}


function closeModalAndContinue() {
    document.getElementById('endSessionModal').style.display = 'none';
    if (!isWorkTime) {
        // It was a break, start work
        workTime = parseInt(document.getElementById('workDuration').value) * 60;
        updateTimerDisplay(workTime, 'Work');
        isWorkTime = true;
    } else {
        // It was work, start break
        breakTime = parseInt(document.getElementById('breakDuration').value) * 60;
        updateTimerDisplay(breakTime, 'Break');
        isWorkTime = false;
    }
    startTimer();
}

function testNotification() {
    console.log("Testing notification");
    if ("Notification" in window) {
        if (Notification.permission === "granted") {
            notify();
            blinkTitle("Time's Up!");
        } else {
            Notification.requestPermission().then(res => {
                if (res === "granted") {
                    notify();
                    blinkTitle("Time's Up!");
                } else {
                    console.error("Did not receive permission for notifications");
                    blinkTitle("Time's Up!"); // Use blinking title as a fallback
                }
            });
        }
    } else {
        console.error("Browser does not support notifications");
        blinkTitle("Time's Up!"); // Use blinking title if notifications are not supported
    }

    function notify() {
        const notification = new Notification('Breaking:', {
            body: 'Time for a break!'
        });

        notification.addEventListener('click', function() {
            window.open('https://www.openjavascript.info');
        });

        setTimeout(() => notification.close(), 5*1000);
    }
}

function blinkTitle(message) {
    let originalTitle = document.title; // Save the current title
    let isOriginal = true;
    const interval = setInterval(() => {
        document.title = isOriginal ? message : originalTitle;
        isOriginal = !isOriginal;
    }, 1000);

    // Optional: Stop blinking after a set time and restore original title
    setTimeout(() => {
        clearInterval(interval);
        document.title = originalTitle;
    }, 10000); // Stop blinking after 10 seconds
}
</script> -->



<script src="./js/app.js"></script>
</body>
</html>
